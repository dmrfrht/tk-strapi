/**
 * Import ADDITIONAL SERVICES section topics to Strapi
 * 
 * Usage: node scripts/import-additional-services-topics.js
 */

const topics = [
  {
    "topicName": "Business upgrade",
    "topicTranslation": "Kabin y√ºkseltme",
    "sectionName": "9 ADDITIONAL SERVICES",
    "sectionTranslation": "EK Hƒ∞ZMETLER",
    "tcmID": "tcm:92-267799-16",
    "linkUri": "/tr-tr/bilgi-edin/business-upgrade-sorulari/index.html",
    "uniqueId": "Kabinykseltme",
    "seoUrl": "business-upgrade-sorulari",
    "metadata": {
      "title": "Business Upgrade (Kabin Y√ºkseltme) Hakkƒ±nda Sorular | T√ºrk Hava Yollarƒ± ¬Æ",
      "keywords": [
        "Kabin y√ºkseltme",
        "business class y√ºkseltme",
        "thy upgrade",
        "thy kabin y√ºkseltme"
      ],
      "robots": [
        {
          "robotsvalue": "index",
          "id": null
        },
        {
          "robotsvalue": "follow",
          "id": null
        }
      ],
      "description": "Business upgrade i≈ülemleri hakkƒ±nda detaylƒ± bilgi almak ve kabin y√ºkseltme se√ßeneklerini √∂ƒürenmek i√ßin sayfamƒ±zƒ± ziyaret edin.",
      "parameters": [
        {
          "key": "p:domain_verify",
          "value": "0521feda9bcfa9c254762a3ddd69e41f",
          "id": null
        }
      ],
      "pubId": null
    }
  },
  {
    "topicName": "Car rental",
    "topicTranslation": "Ara√ß kiralama",
    "sectionName": "9 ADDITIONAL SERVICES",
    "sectionTranslation": "EK Hƒ∞ZMETLER",
    "tcmID": "tcm:92-257282-16",
    "linkUri": "/tr-tr/bilgi-edin/arac-kiralama-sorulari/index.html",
    "uniqueId": "Arakiralama",
    "seoUrl": "arac-kiralama-sorulari",
    "metadata": {
      "title": "Ara√ß Kiralama ƒ∞≈ülemleri ve Sƒ±k√ßa Sorulan Sorular | T√ºrk Hava Yollarƒ± ¬Æ",
      "keywords": [
        "ara√ß kiralama",
        "ara√ß kiralama bilgileri",
        "t√ºrk hava yollarƒ±",
        "sss"
      ],
      "robots": [
        {
          "robotsvalue": "index",
          "id": null
        },
        {
          "robotsvalue": "follow",
          "id": null
        }
      ],
      "description": "Ara√ß kiralama s√ºre√ßleri ve kurallarƒ± hakkƒ±nda detaylƒ± bilgi almak ve seyahatinizi kolayla≈ütƒ±rmak i√ßin sayfamƒ±zƒ± ziyaret edin.",
      "parameters": [
        {
          "key": "p:domain_verify",
          "value": "0521feda9bcfa9c254762a3ddd69e41f",
          "id": null
        }
      ],
      "pubId": null
    }
  },
  {
    "topicName": "E-Visa",
    "topicTranslation": "E-Vize",
    "sectionName": "9 ADDITIONAL SERVICES",
    "sectionTranslation": "EK Hƒ∞ZMETLER",
    "tcmID": "tcm:92-257283-16",
    "linkUri": "/tr-tr/bilgi-edin/e-vize-sorulari/index.html",
    "uniqueId": "EVize",
    "seoUrl": "e-vize-sorulari",
    "metadata": {
      "title": "E-vize Sorularƒ± | T√ºrk Hava Yollarƒ± ¬Æ",
      "keywords": [
        "evize",
        "evize bilgileri",
        "t√ºrk hava yollarƒ±",
        "sss"
      ],
      "robots": [
        {
          "robotsvalue": "index",
          "id": null
        },
        {
          "robotsvalue": "follow",
          "id": null
        }
      ],
      "description": "E-vize i≈ülemleri hakkƒ±nda sƒ±k√ßa sorulan sorulara yanƒ±t almak ve seyahatinizi kolayla≈ütƒ±rmak i√ßin sayfamƒ±zƒ± ziyaret edin.",
      "parameters": [
        {
          "key": "p:domain_verify",
          "value": "0521feda9bcfa9c254762a3ddd69e41f",
          "id": null
        }
      ],
      "pubId": null
    }
  },
  {
    "topicName": "Extra legroom seat",
    "topicTranslation": "Ekstra diz mesafeli koltuk",
    "sectionName": "9 ADDITIONAL SERVICES",
    "sectionTranslation": "EK Hƒ∞ZMETLER",
    "tcmID": "tcm:92-257280-16",
    "linkUri": "/tr-tr/bilgi-edin/ekstra-diz-mesafeli-koltuk-sorulari/index.html",
    "uniqueId": "Ekstradizmesafelikoltuk",
    "seoUrl": "ekstra-diz-mesafeli-koltuk-sorulari",
    "metadata": {
      "title": "Ekstra Diz Mesafeli Koltuklar Hakkƒ±nda Sorular | T√ºrk Hava Yollarƒ± ¬Æ",
      "keywords": [
        "ekstra diz mesafeli koltuk",
        "ekstra diz mesafeli koltuk bilgileri",
        "t√ºrk hava yollarƒ±",
        "sss"
      ],
      "robots": [
        {
          "robotsvalue": "index",
          "id": null
        },
        {
          "robotsvalue": "follow",
          "id": null
        }
      ],
      "description": "Ekstra diz mesafeli koltuklar hakkƒ±nda detaylƒ± bilgi almak ve rezervasyon yapmak i√ßin sayfamƒ±zƒ± ziyaret edin.",
      "parameters": [
        {
          "key": "p:domain_verify",
          "value": "0521feda9bcfa9c254762a3ddd69e41f",
          "id": null
        }
      ],
      "pubId": null
    }
  },
  {
    "topicName": "Hotel",
    "topicTranslation": "Otel",
    "sectionName": "9 ADDITIONAL SERVICES",
    "sectionTranslation": "EK Hƒ∞ZMETLER",
    "tcmID": "tcm:92-257281-16",
    "linkUri": "/tr-tr/bilgi-edin/otel-sorulari/index.html",
    "uniqueId": "Otel",
    "seoUrl": "otel-sorulari",
    "metadata": {
      "title": "Otel Rezervasyonu Sorularƒ± | T√ºrk Hava Yollarƒ± ¬Æ",
      "keywords": [
        "otel",
        "otel bilgileri",
        "t√ºrk hava yollarƒ±",
        "sss"
      ],
      "robots": [
        {
          "robotsvalue": "index",
          "id": null
        },
        {
          "robotsvalue": "follow",
          "id": null
        }
      ],
      "description": "Otel rezervasyonlarƒ±yla ilgili sƒ±k√ßa sorulan sorulara yanƒ±t almak ve s√ºrecinizi kolayla≈ütƒ±rmak i√ßin sayfamƒ±zƒ± ziyaret edin.",
      "parameters": [
        {
          "key": "p:domain_verify",
          "value": "0521feda9bcfa9c254762a3ddd69e41f",
          "id": null
        }
      ],
      "pubId": null
    }
  },
  {
    "topicName": "Seat features",
    "topicTranslation": "Koltuk √∂zellikleri",
    "sectionName": "9 ADDITIONAL SERVICES",
    "sectionTranslation": "EK Hƒ∞ZMETLER",
    "tcmID": "tcm:92-23861-16",
    "linkUri": "/tr-tr/bilgi-edin/koltuk-ozellikleri-sorulari/index.html",
    "uniqueId": "Koltukzellikleri",
    "seoUrl": "koltuk-ozellikleri-sorulari",
    "metadata": {
      "title": "Koltuk √ñzellikleri Sorularƒ± | T√ºrk Hava Yollarƒ± ¬Æ",
      "keywords": [
        "premium economy seats",
        "details",
        "availibility",
        "discounts",
        "dimensions",
        "Compare Seat Options",
        "seats for business",
        "seats for economy",
        "cabin",
        "business class",
        "economy class",
        "luxurious busines flights feature",
        "luxurious economy flights feature"
      ],
      "robots": [
        {
          "robotsvalue": "index",
          "id": null
        },
        {
          "robotsvalue": "follow",
          "id": null
        }
      ],
      "description": "Koltuk √∂zellikleri hakkƒ±nda detaylƒ± bilgi almak ve seyahatinizi konforlu hale getirmek i√ßin sayfamƒ±zƒ± ziyaret edin.",
      "parameters": [
        {
          "key": "p:domain_verify",
          "value": "0521feda9bcfa9c254762a3ddd69e41f",
          "id": null
        }
      ],
      "pubId": null
    }
  },
  {
    "topicName": "Seat selection",
    "topicTranslation": "Koltuk se√ßimi",
    "sectionName": "9 ADDITIONAL SERVICES",
    "sectionTranslation": "EK Hƒ∞ZMETLER",
    "tcmID": "tcm:92-376582-16",
    "linkUri": "/tr-tr/bilgi-edin/koltuk-secimi-sorulari/index.html",
    "uniqueId": "Koltukseimi",
    "seoUrl": "koltuk-secimi-sorulari",
    "metadata": {
      "title": "Koltuk Se√ßimi Sorularƒ± | T√ºrk Hava Yollarƒ± ¬Æ",
      "keywords": [
        "Seat selection faq information",
        "Seat selection",
        "thy faq information",
        "turkish airlines faq information",
        "turkishairlines.com"
      ],
      "robots": [
        {
          "robotsvalue": "index",
          "id": null
        },
        {
          "robotsvalue": "follow",
          "id": null
        }
      ],
      "description": "Koltuk se√ßimiyle ilgili sƒ±k√ßa sorulan sorulara yanƒ±t almak ve tercihlerinizi kolayla≈ütƒ±rmak i√ßin sayfamƒ±zƒ± ziyaret edin.",
      "parameters": [
        {
          "key": "p:domain_verify",
          "value": "0521feda9bcfa9c254762a3ddd69e41f",
          "id": null
        }
      ],
      "pubId": null
    }
  },
  {
    "topicName": "Travel insurance",
    "topicTranslation": "Seyahat sigortasƒ±",
    "sectionName": "9 ADDITIONAL SERVICES",
    "sectionTranslation": "EK Hƒ∞ZMETLER",
    "tcmID": "tcm:92-22658-16",
    "linkUri": "/tr-tr/bilgi-edin/seyahat-sigortasi-sorulari/index.html",
    "uniqueId": "Seyahatsigortas",
    "seoUrl": "seyahat-sigortasi-sorulari",
    "metadata": {
      "title": "Seyahat Sigortasƒ± Sorular | SSS ",
      "keywords": [
        "u√ßu≈üta seyahat sigortasƒ±",
        "u√ßu≈ü seyahat sigortasƒ±",
        "thy seyahat sigortasƒ±",
        "thy sƒ±k sorulan sorular",
        "thy ikram servisi",
        "turk hava yollarƒ±"
      ],
      "robots": [
        {
          "robotsvalue": "index",
          "id": null
        },
        {
          "robotsvalue": "follow",
          "id": null
        }
      ],
      "description": "Seyahat sigortasƒ± hakkƒ±nda sƒ±k sorulan sorulara ve cevaplarƒ±na bu sayfadan ula≈üabilirsiniz.",
      "parameters": [
        {
          "key": "p:domain_verify",
          "value": "0521feda9bcfa9c254762a3ddd69e41f",
          "id": null
        }
      ],
      "pubId": null
    }
  },
  {
    "topicName": "Turkish Airlines Gift Card",
    "topicTranslation": "T√ºrk Hava Yollarƒ± hediye kartƒ±",
    "sectionName": "9 ADDITIONAL SERVICES",
    "sectionTranslation": "EK Hƒ∞ZMETLER",
    "tcmID": "tcm:92-360698-16",
    "linkUri": "/tr-tr/bilgi-edin/turkish-airlines-hediye-kart-sorulari/index.html",
    "uniqueId": "TrkHavaYollarhediyekart",
    "seoUrl": "turkish-airlines-hediye-kart-sorulari",
    "metadata": {
      "title": "T√ºrk Hava Yollarƒ± hediye kartƒ± Bilgi Edin | T√ºrk Hava Yollarƒ± ¬Æ",
      "keywords": [
        "T√ºrk Hava Yollarƒ± Hediye Kart "
      ],
      "robots": [
        {
          "robotsvalue": "index",
          "id": null
        },
        {
          "robotsvalue": "follow",
          "id": null
        }
      ],
      "description": "T√ºrk Hava Yollarƒ± hediye kartƒ± hakkƒ±nda bu sayfadan detaylƒ± bilgi alabilir ve sƒ±k√ßa sorulan sorulara ula≈üabilirsiniz.",
      "parameters": [
        {
          "key": "p:domain_verify",
          "value": "0521feda9bcfa9c254762a3ddd69e41f",
          "id": null
        }
      ],
      "pubId": null
    }
  }
];

async function importAdditionalServicesTopics(app) {
  const locale = 'tr-TR';

  try {
    // 1. Find or create ADDITIONAL SERVICES section
    console.log('üîç Looking for ADDITIONAL SERVICES section...');
    let section = await app.entityService.findMany('api::faq-section.faq-section', {
      locale: locale,
      filters: {
        sectionName: '9 ADDITIONAL SERVICES',
      },
      limit: 1,
    });

    if (!section || section.length === 0) {
      console.log('üìù Creating ADDITIONAL SERVICES section...');
      section = await app.entityService.create('api::faq-section.faq-section', {
        data: {
          sectionName: '9 ADDITIONAL SERVICES',
          sectionTranslation: 'EK Hƒ∞ZMETLER',
          order: 0,
          publishedAt: new Date(),
        },
        locale: locale,
      });
      console.log('‚úÖ ADDITIONAL SERVICES section created with ID:', section.id);
    } else {
      section = section[0];
      console.log('‚úÖ Found existing ADDITIONAL SERVICES section with ID:', section.id);
    }

    // 2. Import topics
    console.log(`\nüì¶ Importing ${topics.length} topics...`);
    let successCount = 0;
    let skipCount = 0;
    let errorCount = 0;

    for (const topicData of topics) {
      try {
        // Check if topic already exists by uniqueId
        const existingTopic = await app.entityService.findMany('api::faq-topic.faq-topic', {
          locale: locale,
          filters: {
            uniqueId: topicData.uniqueId,
          },
          limit: 1,
        });

        if (existingTopic && existingTopic.length > 0) {
          console.log(`‚è≠Ô∏è  Skipping "${topicData.topicTranslation}" - already exists`);
          skipCount++;
          continue;
        }

        // Create topic
        const topic = await app.entityService.create('api::faq-topic.faq-topic', {
          data: {
            topicName: topicData.topicName,
            topicTranslation: topicData.topicTranslation,
            section: section.id,
            tcmID: topicData.tcmID,
            linkUri: topicData.linkUri,
            uniqueId: topicData.uniqueId,
            seoUrl: topicData.seoUrl,
            metadata: topicData.metadata,
            order: 0,
            publishedAt: new Date(),
          },
          locale: locale,
        });

        console.log(`‚úÖ Created: "${topicData.topicTranslation}" (ID: ${topic.id})`);
        successCount++;
      } catch (error) {
        console.error(`‚ùå Error creating "${topicData.topicTranslation}":`, error.message);
        errorCount++;
      }
    }

    // 3. Summary
    console.log('\nüìä Import Summary:');
    console.log(`   ‚úÖ Success: ${successCount}`);
    console.log(`   ‚è≠Ô∏è  Skipped: ${skipCount}`);
    console.log(`   ‚ùå Errors: ${errorCount}`);
    console.log(`   üì¶ Total: ${topics.length}`);
  } catch (error) {
    console.error('‚ùå Fatal error:', error);
    throw error;
  }
}

// Run the import
async function main() {
  const { createStrapi, compileStrapi } = require('@strapi/strapi');
  let app;

  try {
    const appContext = await compileStrapi();
    app = await createStrapi(appContext).load();
    app.log.level = 'error';

    // Make strapi available globally for entityService
    global.strapi = app;

    await importAdditionalServicesTopics(app);
    await app.destroy();
    process.exit(0);
  } catch (error) {
    console.error('‚ùå Fatal error:', error);
    if (app) {
      await app.destroy();
    }
    process.exit(1);
  }
}

main();

