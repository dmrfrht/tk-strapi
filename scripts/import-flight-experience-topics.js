/**
 * Import FLIGHT EXPERIENCE section topics to Strapi
 * 
 * Usage: node scripts/import-flight-experience-topics.js
 */

const topics = [
  {
    "topicName": "As You Wish",
    "topicTranslation": "As You Wish",
    "sectionName": "FLIGHT EXPERIENCE",
    "sectionTranslation": "U√áU≈û DENEYƒ∞Mƒ∞",
    "tcmID": "tcm:92-366105-16",
    "linkUri": "/tr-tr/bilgi-edin/as-you-wish-sorulari/index.html",
    "uniqueId": "AsYouWish",
    "seoUrl": "as-you-wish-sorulari",
    "metadata": {
      "title": "AsYouWish | FAQ | T√ºrk Hava Yollarƒ± ¬Æ",
      "keywords": [
        "asyouwish"
      ],
      "robots": [
        {
          "robotsvalue": "noindex",
          "id": null
        },
        {
          "robotsvalue": "nofollow",
          "id": null
        }
      ],
      "description": "AsYouWish uygulamasƒ± hakkƒ±nda detaylƒ± bilgi almak i√ßin sƒ±k sorulan sorularƒ± ve cevaplarƒ±nƒ± inceleyin. ",
      "parameters": [
        {
          "key": "p:domain_verify",
          "value": "0521feda9bcfa9c254762a3ddd69e41f",
          "id": null
        }
      ],
      "pubId": null
    }
  },
  {
    "topicName": "Boarding pass privileges",
    "topicTranslation": "Bini≈ü kartƒ± ayrƒ±calƒ±klarƒ±",
    "sectionName": "FLIGHT EXPERIENCE",
    "sectionTranslation": "U√áU≈û DENEYƒ∞Mƒ∞",
    "tcmID": "tcm:92-376611-16",
    "linkUri": "/tr-tr/bilgi-edin/binis-karti-ayricaliklari-sorulari/index.html",
    "uniqueId": "Binikartayrcalklar",
    "seoUrl": "binis-karti-ayricaliklari-sorulari",
    "metadata": {
      "title": "Bini≈ü Kartƒ± Ayrƒ±calƒ±klarƒ± ile ƒ∞lgili Sorular | T√ºrk Hava Yollarƒ± ¬Æ",
      "keywords": [
        "Boarding pass privileges faq information",
        "Boarding pass privileges",
        "thy faq information",
        "turkish airlines faq information",
        "turkishairlines.com"
      ],
      "robots": [
        {
          "robotsvalue": "index",
          "id": null
        },
        {
          "robotsvalue": "follow",
          "id": null
        }
      ],
      "description": "Bini≈ü kartƒ± ayrƒ±calƒ±klarƒ±yla ilgili sƒ±k√ßa sorulan sorulara yanƒ±t almak ve yolculuƒüunuzu kolayla≈ütƒ±rmak i√ßin sayfamƒ±zƒ± ziyaret edin.",
      "parameters": [
        {
          "key": "p:domain_verify",
          "value": "0521feda9bcfa9c254762a3ddd69e41f",
          "id": null
        }
      ],
      "pubId": null
    }
  },
  {
    "topicName": "Dining Onboard",
    "topicTranslation": "U√ßak i√ßi ikram",
    "sectionName": "FLIGHT EXPERIENCE",
    "sectionTranslation": "U√áU≈û DENEYƒ∞Mƒ∞",
    "tcmID": "tcm:92-359758-16",
    "linkUri": "/tr-tr/bilgi-edin/ucak-ici-ikram-sorulari/index.html",
    "uniqueId": "Uakiiikram",
    "seoUrl": "ucak-ici-ikram-sorulari",
    "metadata": {
      "title": "U√ßak ƒ∞√ßi ƒ∞kram Sorularƒ± | T√ºrk Hava Yollarƒ± ¬Æ",
      "keywords": [
        "u√ßak i√ßi ikram",
        "sƒ±k√ßa sorulan sorular",
        "t√ºrk hava yollarƒ±",
        "info",
        "faq"
      ],
      "robots": [
        {
          "robotsvalue": "index",
          "id": null
        },
        {
          "robotsvalue": "follow",
          "id": null
        }
      ],
      "description": "U√ßak i√ßi ikram hakkƒ±nda sƒ±k√ßa sorulan sorulara yanƒ±t almak ve hizmet detaylarƒ±nƒ± √∂ƒürenmek i√ßin sayfamƒ±zƒ± ziyaret edin.",
      "parameters": [
        {
          "key": "p:domain_verify",
          "value": "0521feda9bcfa9c254762a3ddd69e41f",
          "id": null
        }
      ],
      "pubId": null
    }
  },
  {
    "topicName": "Inflight entertainment",
    "topicTranslation": "U√ßak i√ßi eƒülence",
    "sectionName": "FLIGHT EXPERIENCE",
    "sectionTranslation": "U√áU≈û DENEYƒ∞Mƒ∞",
    "tcmID": "tcm:92-23864-16",
    "linkUri": "/tr-tr/bilgi-edin/ucak-ici-eglence-sorulari/index.html",
    "uniqueId": "Uakiielence",
    "seoUrl": "ucak-ici-eglence-sorulari",
    "metadata": {
      "title": "U√ßak ƒ∞√ßi Eƒülence Sorularƒ± | T√ºrk Hava Yollarƒ± ¬Æ",
      "keywords": [
        "inflight entertainment",
        "miles&smiles",
        "turkish airlines",
        "thy"
      ],
      "robots": [
        {
          "robotsvalue": "index",
          "id": null
        },
        {
          "robotsvalue": "follow",
          "id": null
        }
      ],
      "description": "U√ßak i√ßi eƒülence sistemleri hakkƒ±nda sƒ±k√ßa sorulan sorulara yanƒ±t almak ve se√ßenekleri √∂ƒürenmek i√ßin sayfamƒ±zƒ± ziyaret edin.",
      "parameters": [
        {
          "key": "p:domain_verify",
          "value": "0521feda9bcfa9c254762a3ddd69e41f",
          "id": null
        }
      ],
      "pubId": null
    }
  },
  {
    "topicName": "In-flight Wifi",
    "topicTranslation": "U√ßak i√ßi baƒülanabilirlik",
    "sectionName": "FLIGHT EXPERIENCE",
    "sectionTranslation": "U√áU≈û DENEYƒ∞Mƒ∞",
    "tcmID": "tcm:92-376610-16",
    "linkUri": "/tr-tr/bilgi-edin/ucak-ici-baglanabilirlik-sorulari/index.html",
    "uniqueId": "Uakiibalanabilirlik",
    "seoUrl": "ucak-ici-baglanabilirlik-sorulari",
    "metadata": {
      "title": "U√ßak ƒ∞√ßi Baƒülanabilirlik Sorularƒ± | T√ºrk Hava Yollarƒ± ¬Æ",
      "keywords": [
        "In-flight Wifi faq information",
        "In-flight Wifi",
        "thy faq information",
        "turkish airlines faq information",
        "turkishairlines.com"
      ],
      "robots": [
        {
          "robotsvalue": "index",
          "id": null
        },
        {
          "robotsvalue": "follow",
          "id": null
        }
      ],
      "description": "U√ßak i√ßi internet ve baƒülantƒ± hizmetleri hakkƒ±nda sƒ±k√ßa sorulan sorulara yanƒ±t almak i√ßin sayfamƒ±zƒ± ziyaret edin.",
      "parameters": [
        {
          "key": "p:domain_verify",
          "value": "0521feda9bcfa9c254762a3ddd69e41f",
          "id": null
        }
      ],
      "pubId": null
    }
  },
  {
    "topicName": "PressReader",
    "topicTranslation": "PressReader",
    "sectionName": "FLIGHT EXPERIENCE",
    "sectionTranslation": "U√áU≈û DENEYƒ∞Mƒ∞",
    "tcmID": "tcm:92-222560-16",
    "linkUri": "/tr-tr/bilgi-edin/pressreader/index.html",
    "uniqueId": "PressReader",
    "seoUrl": "pressreader",
    "metadata": {
      "title": "PressReader Nedir? | Bilgi Edin | T√ºrk Hava Yollarƒ± ¬Æ",
      "keywords": [
        "pressreader app",
        "pressreader mobil",
        "pressreader uygulamasƒ±",
        "gazete dergi uygulamasƒ±"
      ],
      "robots": [
        {
          "robotsvalue": "noindex",
          "id": null
        },
        {
          "robotsvalue": "nofollow",
          "id": null
        }
      ],
      "description": "Akƒ±llƒ± telefon ve tabletler √ºzerinden gazete ve dergilere sƒ±nƒ±rsƒ±z eri≈üim sunan PressReader hakkƒ±nda detaylƒ± bilgilere ula≈üƒ±n.",
      "parameters": [
        {
          "key": "p:domain_verify",
          "value": "0521feda9bcfa9c254762a3ddd69e41f",
          "id": null
        }
      ],
      "pubId": null
    }
  },
  {
    "topicName": "Special meals",
    "topicTranslation": "√ñzel yemek",
    "sectionName": "FLIGHT EXPERIENCE",
    "sectionTranslation": "U√áU≈û DENEYƒ∞Mƒ∞",
    "tcmID": "tcm:92-22710-16",
    "linkUri": "/tr-tr/bilgi-edin/ozel-yemek-servisi-sorulari/index.html",
    "uniqueId": "zelyemek",
    "seoUrl": "ozel-yemek-servisi-sorulari",
    "metadata": {
      "title": "√ñzel Yemek Servisi Sorularƒ± | T√ºrk Hava Yollarƒ± ¬Æ",
      "keywords": [
        "u√ßu≈üta yemek talebi",
        "u√ßu≈üta yemek servisi",
        "thy yemek servisi",
        "thy sƒ±k sorulan sorular",
        "thy ikram servisi",
        "turk hava yollari"
      ],
      "robots": [
        {
          "robotsvalue": "index",
          "id": null
        },
        {
          "robotsvalue": "follow",
          "id": null
        }
      ],
      "description": "√ñzel yemek servisiyle ilgili sƒ±k√ßa sorulan sorulara yanƒ±t almak ve seyahatinizi ki≈üiselle≈ütirmek i√ßin sayfamƒ±zƒ± ziyaret edin.",
      "parameters": [
        {
          "key": "p:domain_verify",
          "value": "0521feda9bcfa9c254762a3ddd69e41f",
          "id": null
        }
      ],
      "pubId": null
    }
  },
  {
    "topicName": "Turkish Airlines Lounges",
    "topicTranslation": "Turkish Airlines Lounges",
    "sectionName": "FLIGHT EXPERIENCE",
    "sectionTranslation": "U√áU≈û DENEYƒ∞Mƒ∞",
    "tcmID": "tcm:92-360697-16",
    "linkUri": "/tr-tr/bilgi-edin/turkish-airlines-lounges-sorulari/index.html",
    "uniqueId": "TurkishAirlinesLounges",
    "seoUrl": "turkish-airlines-lounges-sorulari",
    "metadata": {
      "title": "Turkish Airlines Lounges | Bilgi Edin | T√ºrk Hava Yollarƒ± ¬Æ",
      "keywords": [
        "Turkish Airlines Lounges"
      ],
      "robots": [
        {
          "robotsvalue": "index",
          "id": null
        },
        {
          "robotsvalue": "follow",
          "id": null
        }
      ],
      "description": "Turkish Airlines Lounges hakkƒ±nda bu sayfadan bilgi alabilirsiniz.",
      "parameters": [
        {
          "key": "p:domain_verify",
          "value": "0521feda9bcfa9c254762a3ddd69e41f",
          "id": null
        }
      ],
      "pubId": null
    }
  }
];

async function importFlightExperienceTopics(app) {
  const locale = 'tr-TR';

  try {
    // 1. Find or create FLIGHT EXPERIENCE section
    console.log('üîç Looking for FLIGHT EXPERIENCE section...');
    let section = await app.entityService.findMany('api::faq-section.faq-section', {
      locale: locale,
      filters: {
        sectionName: 'FLIGHT EXPERIENCE',
      },
      limit: 1,
    });

    if (!section || section.length === 0) {
      console.log('üìù Creating FLIGHT EXPERIENCE section...');
      section = await app.entityService.create('api::faq-section.faq-section', {
        data: {
          sectionName: 'FLIGHT EXPERIENCE',
          sectionTranslation: 'U√áU≈û DENEYƒ∞Mƒ∞',
          order: 0,
          publishedAt: new Date(),
        },
        locale: locale,
      });
      console.log('‚úÖ FLIGHT EXPERIENCE section created with ID:', section.id);
    } else {
      section = section[0];
      console.log('‚úÖ Found existing FLIGHT EXPERIENCE section with ID:', section.id);
    }

    // 2. Import topics
    console.log(`\nüì¶ Importing ${topics.length} topics...`);
    let successCount = 0;
    let skipCount = 0;
    let errorCount = 0;

    for (const topicData of topics) {
      try {
        // Check if topic already exists by uniqueId
        const existingTopic = await app.entityService.findMany('api::faq-topic.faq-topic', {
          locale: locale,
          filters: {
            uniqueId: topicData.uniqueId,
          },
          limit: 1,
        });

        if (existingTopic && existingTopic.length > 0) {
          console.log(`‚è≠Ô∏è  Skipping "${topicData.topicTranslation}" - already exists`);
          skipCount++;
          continue;
        }

        // Create topic
        const topic = await app.entityService.create('api::faq-topic.faq-topic', {
          data: {
            topicName: topicData.topicName,
            topicTranslation: topicData.topicTranslation,
            section: section.id,
            tcmID: topicData.tcmID,
            linkUri: topicData.linkUri,
            uniqueId: topicData.uniqueId,
            seoUrl: topicData.seoUrl,
            metadata: topicData.metadata,
            order: 0,
            publishedAt: new Date(),
          },
          locale: locale,
        });

        console.log(`‚úÖ Created: "${topicData.topicTranslation}" (ID: ${topic.id})`);
        successCount++;
      } catch (error) {
        console.error(`‚ùå Error creating "${topicData.topicTranslation}":`, error.message);
        errorCount++;
      }
    }

    // 3. Summary
    console.log('\nüìä Import Summary:');
    console.log(`   ‚úÖ Success: ${successCount}`);
    console.log(`   ‚è≠Ô∏è  Skipped: ${skipCount}`);
    console.log(`   ‚ùå Errors: ${errorCount}`);
    console.log(`   üì¶ Total: ${topics.length}`);
  } catch (error) {
    console.error('‚ùå Fatal error:', error);
    throw error;
  }
}

// Run the import
async function main() {
  const { createStrapi, compileStrapi } = require('@strapi/strapi');
  let app;

  try {
    const appContext = await compileStrapi();
    app = await createStrapi(appContext).load();
    app.log.level = 'error';

    global.strapi = app;

    await importFlightExperienceTopics(app);
    await app.destroy();
    process.exit(0);
  } catch (error) {
    console.error('‚ùå Fatal error:', error);
    if (app) {
      await app.destroy();
    }
    process.exit(1);
  }
}

main();

